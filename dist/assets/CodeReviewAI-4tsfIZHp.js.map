{"version":3,"file":"CodeReviewAI-4tsfIZHp.js","sources":["../../src/services/CodeReviewAI.ts"],"sourcesContent":["/**\n * Code Review AI with Learning\n * AI-powered code review that learns team preferences\n * KEN RULES: PRODUCTION-READY, NO MOCKUPS\n */\n\nexport interface CodeReview {\n  id: string;\n  timestamp: Date;\n  files: Array<{\n    path: string;\n    comments: ReviewComment[];\n  }>;\n  summary: {\n    issuesFound: number;\n    suggestions: number;\n    criticalIssues: number;\n  };\n  overallScore: number; // 0-100\n}\n\nexport interface ReviewComment {\n  id: string;\n  file: string;\n  line: number;\n  severity: 'critical' | 'major' | 'minor' | 'suggestion';\n  category: 'bug' | 'performance' | 'security' | 'style' | 'best-practice';\n  message: string;\n  suggestion?: string;\n  codeSnippet: string;\n  confidence: number; // 0-1\n}\n\nexport interface TeamPreferences {\n  codingStyle: Record<string, any>;\n  namingConventions: Record<string, string>;\n  approvedPatterns: string[];\n  bannedPatterns: string[];\n  customRules: Array<{\n    name: string;\n    description: string;\n    pattern: string;\n    severity: ReviewComment['severity'];\n  }>;\n}\n\n/**\n * Code Review AI with Learning\n */\nexport class CodeReviewAI {\n  private apiKey: string;\n  private reviewHistory: CodeReview[] = [];\n  private teamPreferences: TeamPreferences = {\n    codingStyle: {},\n    namingConventions: {},\n    approvedPatterns: [],\n    bannedPatterns: [],\n    customRules: [],\n  };\n  private feedbackHistory: Array<{\n    commentId: string;\n    accepted: boolean;\n    feedback?: string;\n  }> = [];\n  \n  // Rate limiting configuration\n  private readonly REQUEST_DELAY_MS = 1000; // 1 second between requests\n  private readonly MAX_RETRIES = 3;\n  private readonly INITIAL_RETRY_DELAY_MS = 2000; // 2 seconds\n  private readonly BATCH_SIZE = 5; // Process 5 files at a time\n  private lastRequestTime = 0;\n\n  constructor() {\n    this.apiKey = this.getAPIKey();\n    console.log('[CodeReviewAI] Initialized');\n  }\n\n  /**\n   * Review code changes with rate limiting and batch processing\n   */\n  public async reviewCode(\n    files: Array<{ path: string; content: string; diff?: string }>,\n    onProgress?: (current: number, total: number, fileName: string) => void\n  ): Promise<CodeReview> {\n    console.log(`[CodeReviewAI] Reviewing ${files.length} files with rate limiting...`);\n\n    const review: CodeReview = {\n      id: this.generateId(),\n      timestamp: new Date(),\n      files: [],\n      summary: {\n        issuesFound: 0,\n        suggestions: 0,\n        criticalIssues: 0,\n      },\n      overallScore: 100,\n    };\n\n    // Process files in batches with rate limiting\n    for (let i = 0; i < files.length; i++) {\n      const file = files[i];\n      \n      // Progress callback\n      if (onProgress) {\n        onProgress(i + 1, files.length, file.path);\n      }\n      \n      try {\n        // Wait for rate limit before processing\n        await this.enforceRateLimit();\n        \n        const comments = await this.reviewFileWithRetry(file);\n        if (comments.length > 0) {\n          review.files.push({\n            path: file.path,\n            comments,\n          });\n        }\n      } catch (error: any) {\n        console.error(`[CodeReviewAI] Failed to review ${file.path} after retries:`, error.message);\n        // Continue with next file instead of failing entire review\n      }\n      \n      // Log progress every 10 files\n      if ((i + 1) % 10 === 0) {\n        console.log(`[CodeReviewAI] Progress: ${i + 1}/${files.length} files reviewed`);\n      }\n    }\n\n    // Calculate summary\n    const allComments = review.files.flatMap(f => f.comments);\n    review.summary.issuesFound = allComments.length;\n    review.summary.suggestions = allComments.filter(c => c.severity === 'suggestion').length;\n    review.summary.criticalIssues = allComments.filter(c => c.severity === 'critical').length;\n    review.overallScore = this.calculateScore(allComments);\n\n    this.reviewHistory.push(review);\n    console.log(`[CodeReviewAI] Review complete: ${review.files.length} files with issues found`);\n    return review;\n  }\n\n  /**\n   * Enforce rate limiting between API requests\n   */\n  private async enforceRateLimit(): Promise<void> {\n    const now = Date.now();\n    const timeSinceLastRequest = now - this.lastRequestTime;\n    \n    if (timeSinceLastRequest < this.REQUEST_DELAY_MS) {\n      const delay = this.REQUEST_DELAY_MS - timeSinceLastRequest;\n      await this.sleep(delay);\n    }\n    \n    this.lastRequestTime = Date.now();\n  }\n  \n  /**\n   * Review single file with retry logic\n   */\n  private async reviewFileWithRetry(file: {\n    path: string;\n    content: string;\n    diff?: string;\n  }): Promise<ReviewComment[]> {\n    let lastError: Error | null = null;\n    \n    for (let attempt = 0; attempt <= this.MAX_RETRIES; attempt++) {\n      try {\n        return await this.reviewFile(file);\n      } catch (error: any) {\n        lastError = error;\n        \n        // Check if it's a rate limit error\n        if (error.message.includes('429') || error.message.includes('rate limit')) {\n          if (attempt < this.MAX_RETRIES) {\n            // Exponential backoff: 2s, 4s, 8s\n            const delay = this.INITIAL_RETRY_DELAY_MS * Math.pow(2, attempt);\n            console.log(`[CodeReviewAI] Rate limit hit for ${file.path}, retrying in ${delay}ms (attempt ${attempt + 1}/${this.MAX_RETRIES})`);\n            await this.sleep(delay);\n            continue;\n          }\n        }\n        \n        // For other errors, throw immediately\n        if (!error.message.includes('429')) {\n          throw error;\n        }\n      }\n    }\n    \n    throw lastError || new Error('Review failed after retries');\n  }\n\n  /**\n   * Review single file\n   */\n  private async reviewFile(file: {\n    path: string;\n    content: string;\n    diff?: string;\n  }): Promise<ReviewComment[]> {\n    const comments: ReviewComment[] = [];\n\n    // Skip non-code files\n    const codeExtensions = ['.ts', '.tsx', '.js', '.jsx', '.py', '.java', '.cs', '.cpp', '.c', '.h', '.go', '.rs', '.php', '.rb', '.swift', '.kt'];\n    const fileExt = file.path.substring(file.path.lastIndexOf('.')).toLowerCase();\n    if (!codeExtensions.includes(fileExt)) {\n      console.log(`[CodeReviewAI] Skipping non-code file: ${file.path}`);\n      return comments;\n    }\n\n    try {\n      const prompt = `You are a senior code reviewer. Review this ${file.path} file.\n\n${file.content}\n\nTeam preferences:\n- Coding style: ${JSON.stringify(this.teamPreferences.codingStyle)}\n- Naming conventions: ${JSON.stringify(this.teamPreferences.namingConventions)}\n- Approved patterns: ${this.teamPreferences.approvedPatterns.join(', ')}\n- Banned patterns: ${this.teamPreferences.bannedPatterns.join(', ')}\n\nReturn JSON array of review comments:\n[{\n  \"line\": 10,\n  \"severity\": \"major\",\n  \"category\": \"bug\",\n  \"message\": \"Issue description\",\n  \"suggestion\": \"How to fix\",\n  \"confidence\": 0.9\n}]\n\nFocus on: bugs, security issues, performance problems, and violations of team preferences.`;\n\n      const response = await this.callAI(prompt);\n      const aiComments = this.parseAIResponse(response);\n\n      for (const comment of aiComments) {\n        comments.push({\n          id: this.generateId(),\n          file: file.path,\n          line: comment.line,\n          severity: comment.severity,\n          category: comment.category,\n          message: comment.message,\n          suggestion: comment.suggestion,\n          codeSnippet: this.extractCodeSnippet(file.content, comment.line),\n          confidence: comment.confidence || 0.8,\n        });\n      }\n    } catch (error: any) {\n      console.error(`[CodeReviewAI] Review failed for ${file.path}:`, error.message);\n    }\n\n    return comments;\n  }\n\n  /**\n   * Learn from feedback\n   */\n  public learnFromFeedback(\n    commentId: string,\n    accepted: boolean,\n    feedback?: string\n  ): void {\n    this.feedbackHistory.push({ commentId, accepted, feedback });\n\n    // Find the comment\n    const comment = this.findComment(commentId);\n    if (!comment) return;\n\n    if (accepted) {\n      // Reinforce this type of check\n      this.reinforcePattern(comment);\n    } else {\n      // Suppress this type of check\n      this.suppressPattern(comment);\n    }\n\n    console.log(`[CodeReviewAI] Learned from feedback: ${accepted ? 'accepted' : 'rejected'}`);\n  }\n\n  /**\n   * Update team preferences\n   */\n  public updatePreferences(preferences: Partial<TeamPreferences>): void {\n    this.teamPreferences = {\n      ...this.teamPreferences,\n      ...preferences,\n    };\n    console.log('[CodeReviewAI] Team preferences updated');\n  }\n\n  /**\n   * Get review history\n   */\n  public getReviewHistory(): CodeReview[] {\n    return [...this.reviewHistory];\n  }\n\n  /**\n   * Get learning insights\n   */\n  public getLearningInsights(): {\n    totalReviews: number;\n    acceptanceRate: number;\n    topCategories: Array<{ category: string; count: number }>;\n    improvedAreas: string[];\n  } {\n    const totalFeedback = this.feedbackHistory.length;\n    const accepted = this.feedbackHistory.filter(f => f.accepted).length;\n    const acceptanceRate = totalFeedback > 0 ? (accepted / totalFeedback) * 100 : 0;\n\n    const categoryCount = new Map<string, number>();\n    for (const review of this.reviewHistory) {\n      for (const file of review.files) {\n        for (const comment of file.comments) {\n          const count = categoryCount.get(comment.category) || 0;\n          categoryCount.set(comment.category, count + 1);\n        }\n      }\n    }\n\n    const topCategories = Array.from(categoryCount.entries())\n      .map(([category, count]) => ({ category, count }))\n      .sort((a, b) => b.count - a.count)\n      .slice(0, 5);\n\n    return {\n      totalReviews: this.reviewHistory.length,\n      acceptanceRate,\n      topCategories,\n      improvedAreas: this.teamPreferences.approvedPatterns,\n    };\n  }\n\n  /**\n   * Helper methods\n   */\n  private async callAI(prompt: string): Promise<string> {\n    if (!this.apiKey) {\n      throw new Error('Gemini API key not configured');\n    }\n\n    const response = await fetch(\n      `https://generativelanguage.googleapis.com/v1beta/models/gemini-flash-latest:generateContent?key=${this.apiKey}`,\n      {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          contents: [{ parts: [{ text: prompt }] }],\n          generationConfig: {\n            temperature: 0.3,\n            maxOutputTokens: 4000,\n          },\n        }),\n      }\n    );\n\n    if (!response.ok) {\n      const errorText = await response.text().catch(() => 'Unknown error');\n      throw new Error(`AI API error (${response.status}): ${errorText}`);\n    }\n\n    const data = await response.json();\n    return data.candidates[0].content.parts[0].text;\n  }\n\n  private parseAIResponse(response: string): any[] {\n    try {\n      if (!response || typeof response !== 'string') {\n        return [];\n      }\n      \n      const cleaned = response.replace(/```json\\n?/g, '').replace(/```\\n?/g, '');\n      const jsonMatch = cleaned.match(/\\[[\\s\\S]*\\]/);\n      if (jsonMatch && jsonMatch[0]) {\n        const parsed = JSON.parse(jsonMatch[0]);\n        return Array.isArray(parsed) ? parsed : [];\n      }\n      return [];\n    } catch (error) {\n      console.warn('[CodeReviewAI] Failed to parse AI response:', error);\n      return [];\n    }\n  }\n\n  private extractCodeSnippet(content: string, line: number): string {\n    if (!content || typeof content !== 'string') {\n      return '';\n    }\n    \n    const lines = content.split('\\n');\n    if (!lines || lines.length === 0) {\n      return '';\n    }\n    \n    // Ensure line number is valid\n    const validLine = Math.max(1, Math.min(line || 1, lines.length));\n    const start = Math.max(0, validLine - 2);\n    const end = Math.min(lines.length, validLine + 1);\n    \n    return lines.slice(start, end).join('\\n');\n  }\n\n  private findComment(commentId: string): ReviewComment | null {\n    for (const review of this.reviewHistory) {\n      for (const file of review.files) {\n        const comment = file.comments.find(c => c.id === commentId);\n        if (comment) return comment;\n      }\n    }\n    return null;\n  }\n\n  private reinforcePattern(comment: ReviewComment): void {\n    const pattern = `${comment.category}:${comment.severity}`;\n    if (!this.teamPreferences.approvedPatterns.includes(pattern)) {\n      this.teamPreferences.approvedPatterns.push(pattern);\n    }\n  }\n\n  private suppressPattern(comment: ReviewComment): void {\n    const pattern = `${comment.category}:${comment.severity}`;\n    if (!this.teamPreferences.bannedPatterns.includes(pattern)) {\n      this.teamPreferences.bannedPatterns.push(pattern);\n    }\n  }\n\n  private calculateScore(comments: ReviewComment[]): number {\n    if (comments.length === 0) return 100;\n\n    const severityWeights = {\n      critical: 20,\n      major: 10,\n      minor: 5,\n      suggestion: 2,\n    };\n\n    const totalDeduction = comments.reduce(\n      (sum, c) => sum + severityWeights[c.severity],\n      0\n    );\n\n    return Math.max(0, 100 - totalDeduction);\n  }\n\n  private getAPIKey(): string {\n    if (typeof process !== 'undefined' && process.env?.VITE_GEMINI_API_KEY) {\n      return process.env.VITE_GEMINI_API_KEY;\n    }\n    if (typeof import.meta !== 'undefined' && (import.meta as any).env?.VITE_GEMINI_API_KEY) {\n      return (import.meta as any).env.VITE_GEMINI_API_KEY;\n    }\n    if (typeof localStorage !== 'undefined') {\n      const stored = localStorage.getItem('gemini_api_key');\n      if (stored) return stored;\n    }\n    return '';\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n  \n  /**\n   * Sleep utility for rate limiting\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n}\n\nexport function getCodeReviewAI(): CodeReviewAI {\n  return new CodeReviewAI();\n}\n"],"names":["CodeReviewAI","files","onProgress","review","i","file","comments","error","allComments","f","c","timeSinceLastRequest","delay","lastError","attempt","codeExtensions","fileExt","prompt","response","aiComments","comment","commentId","accepted","feedback","preferences","totalFeedback","acceptanceRate","categoryCount","count","topCategories","category","a","b","errorText","jsonMatch","parsed","content","line","lines","validLine","start","end","pattern","severityWeights","totalDeduction","sum","define_process_env_default","stored","ms","resolve","getCodeReviewAI"],"mappings":"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"}