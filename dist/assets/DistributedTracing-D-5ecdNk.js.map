{"version":3,"file":"DistributedTracing-D-5ecdNk.js","sources":["../../src/services/DistributedTracing.ts"],"sourcesContent":["/**\n * Distributed Tracing Service\n * OpenTelemetry-compatible tracing for performance monitoring\n * KEN RULES: PRODUCTION-READY, NO MOCKUPS\n */\n\nexport interface Span {\n  id: string;\n  traceId: string;\n  parentId?: string;\n  name: string;\n  startTime: Date;\n  endTime?: Date;\n  duration?: number;\n  attributes: Record<string, any>;\n  events: Array<{\n    timestamp: Date;\n    name: string;\n    attributes?: Record<string, any>;\n  }>;\n  status: 'ok' | 'error';\n  error?: string;\n}\n\nexport interface Trace {\n  id: string;\n  rootSpan: Span;\n  spans: Span[];\n  duration: number;\n  serviceName: string;\n}\n\n/**\n * Distributed Tracing Service\n */\nexport class DistributedTracingService {\n  private traces: Map<string, Trace> = new Map();\n  private activeSpans: Map<string, Span> = new Map();\n\n  constructor() {\n    console.log('[DistributedTracing] Service initialized');\n  }\n\n  /**\n   * Start trace\n   */\n  public startTrace(name: string, attributes?: Record<string, any>): string {\n    const traceId = this.generateId();\n    const span = this.startSpan(name, traceId, undefined, attributes);\n\n    const trace: Trace = {\n      id: traceId,\n      rootSpan: span,\n      spans: [span],\n      duration: 0,\n      serviceName: 'gemini-ide',\n    };\n\n    this.traces.set(traceId, trace);\n    return traceId;\n  }\n\n  /**\n   * Start span\n   */\n  public startSpan(\n    name: string,\n    traceId: string,\n    parentId?: string,\n    attributes?: Record<string, any>\n  ): Span {\n    const span: Span = {\n      id: this.generateId(),\n      traceId,\n      parentId,\n      name,\n      startTime: new Date(),\n      attributes: attributes || {},\n      events: [],\n      status: 'ok',\n    };\n\n    this.activeSpans.set(span.id, span);\n\n    const trace = this.traces.get(traceId);\n    if (trace) {\n      trace.spans.push(span);\n    }\n\n    return span;\n  }\n\n  /**\n   * End span\n   */\n  public endSpan(spanId: string, error?: Error): void {\n    const span = this.activeSpans.get(spanId);\n    if (!span) return;\n\n    span.endTime = new Date();\n    span.duration = span.endTime.getTime() - span.startTime.getTime();\n\n    if (error) {\n      span.status = 'error';\n      span.error = error.message;\n    }\n\n    this.activeSpans.delete(spanId);\n\n    // Update trace duration\n    const trace = this.traces.get(span.traceId);\n    if (trace && span.id === trace.rootSpan.id) {\n      trace.duration = span.duration;\n    }\n  }\n\n  /**\n   * Add event to span\n   */\n  public addEvent(spanId: string, name: string, attributes?: Record<string, any>): void {\n    const span = this.activeSpans.get(spanId);\n    if (span) {\n      span.events.push({\n        timestamp: new Date(),\n        name,\n        attributes,\n      });\n    }\n  }\n\n  /**\n   * Get traces\n   */\n  public getTraces(): Trace[] {\n    return Array.from(this.traces.values());\n  }\n\n  /**\n   * Export traces\n   */\n  public exportTraces(format: 'jaeger' | 'zipkin'): string {\n    const traces = this.getTraces();\n    if (format === 'jaeger') return this.exportJaeger(traces);\n    return this.exportZipkin(traces);\n  }\n\n  private exportJaeger(traces: Trace[]): string {\n    return JSON.stringify({\n      data: traces.map(trace => ({\n        traceID: trace.id,\n        spans: trace.spans.map(span => ({\n          spanID: span.id,\n          operationName: span.name,\n          startTime: span.startTime.getTime() * 1000,\n          duration: span.duration || 0,\n          tags: Object.entries(span.attributes).map(([key, value]) => ({\n            key,\n            type: typeof value,\n            value,\n          })),\n        })),\n      })),\n    });\n  }\n\n  private exportZipkin(traces: Trace[]): string {\n    return JSON.stringify(\n      traces.flatMap(trace =>\n        trace.spans.map(span => ({\n          traceId: trace.id,\n          id: span.id,\n          parentId: span.parentId,\n          name: span.name,\n          timestamp: span.startTime.getTime() * 1000,\n          duration: (span.duration || 0) * 1000,\n          tags: span.attributes,\n        }))\n      )\n    );\n  }\n\n  private generateId(): string {\n    return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  }\n}\n\nexport function getDistributedTracing(): DistributedTracingService {\n  return new DistributedTracingService();\n}\n"],"names":["DistributedTracingService","name","attributes","traceId","span","trace","parentId","spanId","error","format","traces","key","value","getDistributedTracing"],"mappings":"AAmCO,MAAMA,CAA0B,CAIrC,aAAc,CAHd,KAAQ,WAAiC,IACzC,KAAQ,gBAAqC,IAG3C,QAAQ,IAAI,0CAA0C,CACxD,CAKO,WAAWC,EAAcC,EAA0C,CACxE,MAAMC,EAAU,KAAK,WAAA,EACfC,EAAO,KAAK,UAAUH,EAAME,EAAS,OAAWD,CAAU,EAE1DG,EAAe,CACnB,GAAIF,EACJ,SAAUC,EACV,MAAO,CAACA,CAAI,EACZ,SAAU,EACV,YAAa,YAAA,EAGf,YAAK,OAAO,IAAID,EAASE,CAAK,EACvBF,CACT,CAKO,UACLF,EACAE,EACAG,EACAJ,EACM,CACN,MAAME,EAAa,CACjB,GAAI,KAAK,WAAA,EACT,QAAAD,EACA,SAAAG,EACA,KAAAL,EACA,cAAe,KACf,WAAYC,GAAc,CAAA,EAC1B,OAAQ,CAAA,EACR,OAAQ,IAAA,EAGV,KAAK,YAAY,IAAIE,EAAK,GAAIA,CAAI,EAElC,MAAMC,EAAQ,KAAK,OAAO,IAAIF,CAAO,EACrC,OAAIE,GACFA,EAAM,MAAM,KAAKD,CAAI,EAGhBA,CACT,CAKO,QAAQG,EAAgBC,EAAqB,CAClD,MAAMJ,EAAO,KAAK,YAAY,IAAIG,CAAM,EACxC,GAAI,CAACH,EAAM,OAEXA,EAAK,YAAc,KACnBA,EAAK,SAAWA,EAAK,QAAQ,UAAYA,EAAK,UAAU,QAAA,EAEpDI,IACFJ,EAAK,OAAS,QACdA,EAAK,MAAQI,EAAM,SAGrB,KAAK,YAAY,OAAOD,CAAM,EAG9B,MAAMF,EAAQ,KAAK,OAAO,IAAID,EAAK,OAAO,EACtCC,GAASD,EAAK,KAAOC,EAAM,SAAS,KACtCA,EAAM,SAAWD,EAAK,SAE1B,CAKO,SAASG,EAAgBN,EAAcC,EAAwC,CACpF,MAAME,EAAO,KAAK,YAAY,IAAIG,CAAM,EACpCH,GACFA,EAAK,OAAO,KAAK,CACf,cAAe,KACf,KAAAH,EACA,WAAAC,CAAA,CACD,CAEL,CAKO,WAAqB,CAC1B,OAAO,MAAM,KAAK,KAAK,OAAO,QAAQ,CACxC,CAKO,aAAaO,EAAqC,CACvD,MAAMC,EAAS,KAAK,UAAA,EACpB,OAAID,IAAW,SAAiB,KAAK,aAAaC,CAAM,EACjD,KAAK,aAAaA,CAAM,CACjC,CAEQ,aAAaA,EAAyB,CAC5C,OAAO,KAAK,UAAU,CACpB,KAAMA,EAAO,IAAIL,IAAU,CACzB,QAASA,EAAM,GACf,MAAOA,EAAM,MAAM,IAAID,IAAS,CAC9B,OAAQA,EAAK,GACb,cAAeA,EAAK,KACpB,UAAWA,EAAK,UAAU,QAAA,EAAY,IACtC,SAAUA,EAAK,UAAY,EAC3B,KAAM,OAAO,QAAQA,EAAK,UAAU,EAAE,IAAI,CAAC,CAACO,EAAKC,CAAK,KAAO,CAC3D,IAAAD,EACA,KAAM,OAAOC,EACb,MAAAA,CAAA,EACA,CAAA,EACF,CAAA,EACF,CAAA,CACH,CACH,CAEQ,aAAaF,EAAyB,CAC5C,OAAO,KAAK,UACVA,EAAO,QAAQL,GACbA,EAAM,MAAM,IAAID,IAAS,CACvB,QAASC,EAAM,GACf,GAAID,EAAK,GACT,SAAUA,EAAK,SACf,KAAMA,EAAK,KACX,UAAWA,EAAK,UAAU,QAAA,EAAY,IACtC,UAAWA,EAAK,UAAY,GAAK,IACjC,KAAMA,EAAK,UAAA,EACX,CAAA,CACJ,CAEJ,CAEQ,YAAqB,CAC3B,MAAO,GAAG,KAAK,IAAA,CAAK,IAAI,KAAK,OAAA,EAAS,SAAS,EAAE,EAAE,OAAO,EAAG,CAAC,CAAC,EACjE,CACF,CAEO,SAASS,GAAmD,CACjE,OAAO,IAAIb,CACb"}