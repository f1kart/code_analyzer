class n{constructor(){this.traces=new Map,this.activeSpans=new Map,console.log("[DistributedTracing] Service initialized")}startTrace(i,e){const t=this.generateId(),r=this.startSpan(i,t,void 0,e),a={id:t,rootSpan:r,spans:[r],duration:0,serviceName:"gemini-ide"};return this.traces.set(t,a),t}startSpan(i,e,t,r){const a={id:this.generateId(),traceId:e,parentId:t,name:i,startTime:new Date,attributes:r||{},events:[],status:"ok"};this.activeSpans.set(a.id,a);const s=this.traces.get(e);return s&&s.spans.push(a),a}endSpan(i,e){const t=this.activeSpans.get(i);if(!t)return;t.endTime=new Date,t.duration=t.endTime.getTime()-t.startTime.getTime(),e&&(t.status="error",t.error=e.message),this.activeSpans.delete(i);const r=this.traces.get(t.traceId);r&&t.id===r.rootSpan.id&&(r.duration=t.duration)}addEvent(i,e,t){const r=this.activeSpans.get(i);r&&r.events.push({timestamp:new Date,name:e,attributes:t})}getTraces(){return Array.from(this.traces.values())}exportTraces(i){const e=this.getTraces();return i==="jaeger"?this.exportJaeger(e):this.exportZipkin(e)}exportJaeger(i){return JSON.stringify({data:i.map(e=>({traceID:e.id,spans:e.spans.map(t=>({spanID:t.id,operationName:t.name,startTime:t.startTime.getTime()*1e3,duration:t.duration||0,tags:Object.entries(t.attributes).map(([r,a])=>({key:r,type:typeof a,value:a}))}))}))})}exportZipkin(i){return JSON.stringify(i.flatMap(e=>e.spans.map(t=>({traceId:e.id,id:t.id,parentId:t.parentId,name:t.name,timestamp:t.startTime.getTime()*1e3,duration:(t.duration||0)*1e3,tags:t.attributes}))))}generateId(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}}function c(){return new n}export{n as DistributedTracingService,c as getDistributedTracing};
//# sourceMappingURL=DistributedTracing-D-5ecdNk.js.map
